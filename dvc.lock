schema: '2.0'
stages:
  download_nltk:
    cmd: python ner_roberta/training/download_files.py
    outs:
    - path: ./model_package/NLTK
      md5: 2fd65ec9def6cebca3f72c28e38a7aed.dir
      size: 59170146
      nfiles: 41
  prepare:
    cmd: python ner_roberta\training\train_data_preporation.py
    deps:
    - path: ./model_package/NLTK
      md5: 2fd65ec9def6cebca3f72c28e38a7aed.dir
      size: 59170146
      nfiles: 41
    - path: .\ner.csv
      md5: 9eb4100fdf82f737e604c4a2b4071542
      size: 19690323
    params:
      params.yaml:
        DATA:
          TRAIN_SAMPLE_FRACTURE: 0.8
          VAL_VS_TEST_FRACTURE: 0.5
          RAW_INPUT_FILEPATH: ner.csv
          TRAIN_DATASET_PATH: data/train_dataset.pkl
          VAL_DATASET_PATH: data/val_dataset.pkl
          TEST_DATASET_PATH: data/test_dataset.pkl
          DEVICE: cpu
    outs:
    - path: .\data\ner_tags_dict.json
      md5: d4cc29f0721cb463720729cd8eba4c68
      size: 169
    - path: .\data\pos_tags_dict.json
      md5: f7729f40f0d5310ca038846e240bfe7b
      size: 331
    - path: .\data\test_dataset.pkl
      md5: c0fa55ffc457e28a798e4bb4e59a5bc2
      size: 43940088
    - path: .\data\train_dataset.pkl
      md5: 0414d501e7aae40b75f1f8926b2d86c2
      size: 331757382
    - path: .\data\val_dataset.pkl
      md5: 81d20c60201fb338060cd9f2cb708198
      size: 43945730
  train:
    cmd: python ner_roberta\training\train_pipeline.py
    deps:
    - path: .\data\ner_tags_dict.json
      md5: d4cc29f0721cb463720729cd8eba4c68
      size: 169
    - path: .\data\pos_tags_dict.json
      md5: f7729f40f0d5310ca038846e240bfe7b
      size: 331
    - path: .\data\test_dataset.pkl
      md5: c0fa55ffc457e28a798e4bb4e59a5bc2
      size: 43940088
    - path: .\data\train_dataset.pkl
      md5: 0414d501e7aae40b75f1f8926b2d86c2
      size: 331757382
    - path: .\data\val_dataset.pkl
      md5: 81d20c60201fb338060cd9f2cb708198
      size: 43945730
    params:
      params.yaml:
        MODEL:
          DEFAULT_SENTENCE_LEN: 512
          DEVICE: cuda
          TOKENIZER_NAME: roberta-base
          PRETRAINED_MODEL_NAME: roberta-base
          POS_EMBEDDINGS_SIZE: 8
        TRAIN:
          EVAL_STEPS: 500
          TRAIN_BATCH_SIZE: 4
          VAL_BATCH_SIZE: 4
          TRAIN_EPOCHS: 16
          SAVE_STEPS: 2000
          USE_FLOAT_PRECISION_16: true
          GRADIENT_ACCUMULATION_STEPS: 4
          EVAL_ACCUMULATION_STEPS: 4
          START_TRAIN_CHECKPOINT: output/checkpoint-38000
          LEARNING_RATE: 5e-06
          WEIGHTS_DECAY: 0.01
    outs:
    - path: output/model
      md5: 747b5a0b2d95ef4fc3e4ac5fd5e7893b.dir
      size: 496357724
      nfiles: 2
    - path: output/test_metrics.json
      md5: 5eedd615fb872daa781635e01e3a1688
      size: 252
    - path: output/val_metrics.json
      md5: 279ba1e06a290fd542fd4e7091cdbd95
      size: 253
  assemble_bundle:
    cmd: python ner_roberta/training/assemble_scoring_bundle.py
    deps:
    - path: .\data\ner_tags_dict.json
      md5: d4cc29f0721cb463720729cd8eba4c68
      size: 169
    - path: .\data\pos_tags_dict.json
      md5: f7729f40f0d5310ca038846e240bfe7b
      size: 331
    - path: Pipfile
      md5: 2f4a64aff703a40a4c7a466d4ec8f96c
      size: 489
    - path: Pipfile.lock
      md5: 2e98a97860711c20de3e9d1c2fcdb324
      size: 143383
    - path: data/ner_description.json
      md5: 671f0cb721d7ca01e30cbbdf7986e34f
      size: 426
    - path: model_package/NLTK
      md5: 2fd65ec9def6cebca3f72c28e38a7aed.dir
      size: 59170146
      nfiles: 41
    - path: ner_roberta/scoring/score_model.py
      md5: bf79c1e47a0121eee03441615fa2c644
      size: 3614
    - path: ner_roberta/scoring/server.py
      md5: 625610525ed5e880a33b50a15e1e940d
      size: 10763
    - path: output/model
      md5: 747b5a0b2d95ef4fc3e4ac5fd5e7893b.dir
      size: 496357724
      nfiles: 2
    outs:
    - path: model_package/Pipfile
      md5: 2f4a64aff703a40a4c7a466d4ec8f96c
      size: 489
    - path: model_package/Pipfile.lock
      md5: 2e98a97860711c20de3e9d1c2fcdb324
      size: 143383
    - path: model_package/config.json
      md5: 4bbeef0f565005830b020bd1186e46a9
      size: 255
    - path: model_package/model.pt
      md5: e3607f7029be7b864a8119ebd575bbcb
      size: 496351661
    - path: model_package/ner_description.json
      md5: 671f0cb721d7ca01e30cbbdf7986e34f
      size: 426
    - path: model_package/ner_tags_dict.json
      md5: d4cc29f0721cb463720729cd8eba4c68
      size: 169
    - path: model_package/pos_tags_dict.json
      md5: f7729f40f0d5310ca038846e240bfe7b
      size: 331
    - path: model_package/score_model.py
      md5: bf79c1e47a0121eee03441615fa2c644
      size: 3614
    - path: model_package/server.py
      md5: 625610525ed5e880a33b50a15e1e940d
      size: 10763
    - path: model_package/test_examples.json
      md5: d503b830b0516184a8c3d886949513f5
      size: 1268
    - path: model_package/tokenizer
      md5: d42388ef9f4d5e18915f4a34cfca3d84.dir
      size: 1558355
      nfiles: 4
  build_docker:
    cmd: docker build --tag eu.gcr.io/nlp-masters-project/ner-roberta:v1.7 .
    deps:
    - path: Dockerfile
      md5: c21733c5d7fa9e9769414fd9c55aec59
      size: 844
    - path: model_package/Pipfile
      md5: 2f4a64aff703a40a4c7a466d4ec8f96c
      size: 489
    - path: model_package/Pipfile.lock
      md5: 2e98a97860711c20de3e9d1c2fcdb324
      size: 143383
    - path: model_package/config.json
      md5: 4bbeef0f565005830b020bd1186e46a9
      size: 255
    - path: model_package/model.pt
      md5: e3607f7029be7b864a8119ebd575bbcb
      size: 496351661
    - path: model_package/ner_description.json
      md5: 671f0cb721d7ca01e30cbbdf7986e34f
      size: 426
    - path: model_package/ner_tags_dict.json
      md5: d4cc29f0721cb463720729cd8eba4c68
      size: 169
    - path: model_package/pos_tags_dict.json
      md5: f7729f40f0d5310ca038846e240bfe7b
      size: 331
    - path: model_package/score_model.py
      md5: bf79c1e47a0121eee03441615fa2c644
      size: 3614
    - path: model_package/server.py
      md5: 625610525ed5e880a33b50a15e1e940d
      size: 10763
    - path: model_package/test_examples.json
      md5: d503b830b0516184a8c3d886949513f5
      size: 1268
    - path: model_package/tokenizer
      md5: d42388ef9f4d5e18915f4a34cfca3d84.dir
      size: 1558355
      nfiles: 4
